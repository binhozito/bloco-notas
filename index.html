<!-- CORREÃ‡ÃƒO: SALVAMENTO REAL NO GITHUB -->
<!-- Interface -->
<button id="saveGithub" style="position:fixed;bottom:20px;right:20px;z-index:9999;padding:10px 16px;border-radius:8px;border:none;background:#22c55e;color:#000;font-weight:bold;cursor:pointer">ðŸ’¾ Salvar no GitHub</button>

<script>
// --- CONFIGURAÃ‡ÃƒO DO GIST ---
const GIST_ID = "COLE_AQUI_SEU_GIST_ID"; // obrigatÃ³rio

// --- TOKEN ---
let GITHUB_TOKEN = localStorage.getItem("github_token");
if (!GITHUB_TOKEN) {
  const t = prompt("Cole seu GitHub Token (fica sÃ³ neste navegador):");
  if (t) {
    localStorage.setItem("github_token", t);
    GITHUB_TOKEN = t;
  }
}

// --- SENHA MESTRA (COM LEMBRAR NESTE DISPOSITIVO) ---
let masterPassword = localStorage.getItem("master_password");
if (!masterPassword) {
  masterPassword = prompt("Digite sua senha mestra (opÃ§Ã£o de lembrar serÃ¡ automÃ¡tica neste dispositivo):");
  if (masterPassword) {
    const remember = confirm("Deseja lembrar a senha neste dispositivo?");
    if (remember) {
      localStorage.setItem("master_password", masterPassword);
    } else {
      sessionStorage.setItem("master_password", masterPassword);
    }
  }
}

// --- CRIPTOGRAFIA SIMPLES ---
function encrypt(text, password) {
  return btoa(unescape(encodeURIComponent(password + "::" + text)));
}
function decrypt(data, password) {
  const decoded = decodeURIComponent(escape(atob(data)));
  if (!decoded.startsWith(password + "::")) throw new Error("Senha incorreta");
  return decoded.replace(password + "::", "");
}

// --- SALVAR ---
document.getElementById("saveGithub").onclick = async () => {
  try {
    const content = document.body.innerText || "";
    const encrypted = encrypt(content, masterPassword);

    const res = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
      method: "PATCH",
      headers: {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        files: {
          "notas.txt": { content: encrypted }
        }
      })
    });

    if (!res.ok) throw new Error("Erro ao salvar");
    alert("âœ… Salvo com sucesso no GitHub");
  } catch (e) {
    alert("Erro ao salvar: " + e.message);
  }
};

// --- CARREGAR ---
(async () => {
  try {
    const res = await fetch(`https://api.github.com/gists/${GIST_ID}`);
    const data = await res.json();
    if (data.files && data.files["notas.txt"]) {
      const decrypted = decrypt(data.files["notas.txt"].content, masterPassword);
      document.body.innerText = decrypted;
    }
  } catch (e) {
    console.log("Primeiro uso ou senha diferente");
  }
})();
</script>
